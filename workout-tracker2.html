<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Progressive 5x5 Dumbbell Program</title>
  <style>
    :root{--accent:#3b82f6;--muted:#6b7280;--success:#10b981;--warning:#f59e0b;--danger:#ef4444}
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;background:#f5f5f5;margin:0;padding:20px;color:#111}
    .container{max-width:1100px;margin:0 auto}
    .card{background:#fff;padding:18px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.06);margin-bottom:18px}
    h1{font-size:1.4rem;margin:0 0 6px}
    p.lead{margin:0;color:var(--muted)}
    .controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .week-selector{display:flex;gap:8px;flex-wrap:wrap}
    .week-btn{padding:8px 12px;border-radius:8px;border:2px solid #ddd;background:#fff;font-weight:600;cursor:pointer}
    .week-btn:hover{background:#f3f4f6}
    .week-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}
    .week-btn.deload{background:#fef3c7;border-color:#fbbf24}
    .week-btn.deload.active{background:#fbbf24;color:#78350f}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
    .day-card{padding:14px;border-radius:8px;border:2px solid transparent;cursor:pointer}
    .day-card:hover{transform:translateY(-4px);transition:transform .12s}
    .day-card.selected{border-color:var(--accent);background:#eff6ff}
    .exercise-card{padding:12px;border-radius:8px;border:1px solid #e6e6e6;margin-bottom:10px;background:#fafafa}
    .set-buttons{display:flex;gap:8px;flex-wrap:wrap}
    .set-btn{padding:8px 10px;border-radius:6px;border:1px solid #d1d5db;background:#fff;cursor:pointer}
    .set-btn.complete{background:var(--success);color:#fff;border-color:var(--success)}
    .set-btn.failed{background:var(--danger);color:#fff;border-color:var(--danger)}
    .hidden{display:none}
    .muted{color:var(--muted);font-size:.95rem}
    .flex{display:flex;gap:12px;align-items:center}
    .spacer{flex:1}
    .small{font-size:.9rem}
    .alert{padding:12px;border-radius:8px;background:#dbeafe;border-left:4px solid var(--accent);margin-bottom:14px}
    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:0.9rem}
    @media print{.controls,button{display:none}}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Progressive 5x5 Dumbbell Program</h1>
      <p class="lead">Track sets, weights and progression. Every 4th week is a deload (70%).</p>
      <div id="cycleInfo" class="muted small" style="margin-top:10px"></div>
    </div>

    <div class="card controls" aria-label="controls">
      <div>
        <strong>Select Week</strong>
        <div id="weekSelector" class="week-selector" aria-label="week selector"></div>
      </div>
      <div class="spacer"></div>
      <div style="min-width:220px;text-align:right">
        <button id="exportBtn" class="week-btn" title="Export CSV">Download CSV</button>
        <button id="resetBtn" class="week-btn" title="Reset progress">Reset</button>
      </div>
    </div>

    <div id="weekAlert" class="alert hidden" role="status"></div>
    <div id="workoutGrid" class="grid"></div>
    <div id="workoutDetail" class="card hidden" aria-live="polite"></div>
    <footer class="muted">Built for local usage — data stored in your browser (localStorage).</footer>
  </div>

  <script>
  (function appModule(){
    'use strict';

    const PROGRAM = {
      1: { name: "Upper Body Push", exercises: [
        { name:"Incline Dumbbell Press", sets:5, reps:5, startWeight:25, notes:"Focus on upper chest" },
        { name:"Standing Overhead Press", sets:5, reps:5, startWeight:20, notes:"Strict form" },
        { name:"Dumbbell Floor Press", sets:5, reps:5, startWeight:30, notes:"Protect shoulders" },
        { name:"Lateral Raises", sets:3, reps:12, startWeight:10, notes:"Slight bend in elbow" },
        { name:"Overhead Tricep Extension", sets:3, reps:10, startWeight:20, notes:"Single DB, both arms" }
      ]},
      2: { name: "Lower Body", exercises: [
        { name:"Goblet Squats", sets:5, reps:5, startWeight:40, notes:"Hold one DB at chest" },
        { name:"Romanian Deadlifts", sets:5, reps:5, startWeight:30, notes:"Hinge at hips" },
        { name:"Bulgarian Split Squats", sets:4, reps:8, startWeight:20, notes:"Each leg" },
        { name:"Dumbbell Lunges", sets:3, reps:10, startWeight:20, notes:"Each leg, walking" },
        { name:"Calf Raises", sets:3, reps:15, startWeight:30, notes:"On step, hold DBs" }
      ]},
      3: { name: "Cardio & Core", exercises: [
        { name:"Treadmill Intervals", sets:1, reps:20, startWeight:0, notes:"20 min total" },
        { name:"Plank", sets:3, reps:1, startWeight:0, notes:"Hold 30-60s" },
        { name:"Russian Twists", sets:3, reps:20, startWeight:15, notes:"One DB" },
        { name:"Dumbbell Side Bends", sets:3, reps:15, startWeight:25, notes:"Each side" },
        { name:"Lying Leg Raises", sets:3, reps:12, startWeight:0, notes:"Slow and controlled" }
      ]},
      4: { name: "Upper Body Pull", exercises: [
        { name:"Bent Over Rows", sets:5, reps:5, startWeight:35, notes:"Pull to hip" },
        { name:"Single Arm Row", sets:4, reps:8, startWeight:40, notes:"Each arm" },
        { name:"Dumbbell Pullover", sets:4, reps:10, startWeight:30, notes:"Chest/back combo" },
        { name:"Hammer Curls", sets:4, reps:10, startWeight:20, notes:"Neutral grip" },
        { name:"Reverse Flyes", sets:3, reps:12, startWeight:12, notes:"Rear delts" }
      ]},
      5: { name: "Full Body & Cardio", exercises: [
        { name:"Dumbbell Clean & Press", sets:4, reps:8, startWeight:25, notes:"Explosive" },
        { name:"Goblet Squats", sets:4, reps:8, startWeight:40, notes:"Similar to Day 2" },
        { name:"Push-ups", sets:3, reps:15, startWeight:0, notes:"On knees if needed" },
        { name:"Dumbbell Swings", sets:3, reps:15, startWeight:30, notes:"Hip drive" },
        { name:"Treadmill Intervals", sets:1, reps:15, startWeight:0, notes:"15 min" }
      ]}
    };

    /* ---------- DataStore ---------- */
    const DataStore = (function(){
      const prefix='prog_v1_';
      const safeGet = (k,fallback)=>{ try { const r=localStorage.getItem(k); return r?JSON.parse(r):fallback; } catch(e){return fallback;} };
      const safeSet = (k,v)=>{ try { localStorage.setItem(k, JSON.stringify(v)); } catch(e){} };
      const key=(...parts)=>prefix+parts.join('|');
      return {
        getCycle(){ try{return parseInt(localStorage.getItem(key('currentCycle'))||'1',10);}catch{return 1;} },
        setCycle(v){ try{localStorage.setItem(key('currentCycle'),v);}catch{} },
        getWeek(){ try{return parseInt(localStorage.getItem(key('currentWeek'))||'1',10);}catch{return 1;} },
        setWeek(v){ try{localStorage.setItem(key('currentWeek'),v);}catch{} },
        saveProgress(cycle, week, day, exIdx, setNum, value){ localStorage.setItem(key('p',cycle,week,day,exIdx,'s'+setNum),value); },
        getProgress(cycle, week, day, exIdx, setNum){ return localStorage.getItem(key('p',cycle,week,day,exIdx,'s'+setNum))||null; },
        saveWeight(cycle, week, day, exIdx, weight){ localStorage.setItem(key('w',cycle,week,day,exIdx),weight); },
        getSavedWeight(cycle, week, day, exIdx){ const v=localStorage.getItem(key('w',cycle,week,day,exIdx)); return v!==null?parseFloat(v):null; },
        saveAdjustment(cycle, week, day, exIdx, adj){ localStorage.setItem(key('a',cycle,week,day,exIdx),adj); },
        getAdjustment(cycle, week, day, exIdx){ const v=localStorage.getItem(key('a',cycle,week,day,exIdx)); return v!==null?parseFloat(v):null; },
        exportCSV(){ const rows=[['key','value']]; for(let i=0;i<localStorage.length;i++){ const k=localStorage.key(i); if(k&&k.startsWith(prefix)) rows.push([k,localStorage.getItem(k)]); } return rows.map(r=>r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n'); },
        resetAll(){ const toRemove=[]; for(let i=0;i<localStorage.length;i++){ const k=localStorage.key(i); if(k&&k.startsWith(prefix)) toRemove.push(k); } toRemove.forEach(k=>localStorage.removeItem(k)); }
      };
    })();

    function getWeekType(w){ return (w%4===0)?'deload':'normal'; }

    function getExercisePerformance(cycle, week, day, exIdx, totalSets){
      let completed=0, failed=0;
      for(let s=1;s<=totalSets;s++){
        const p=DataStore.getProgress(cycle,week,day,exIdx,s);
        if(p==='complete') completed++;
        else if(p==='failed') failed++;
      }
      return {completed, failed, total:totalSets};
    }

    function didCompleteLastWeek(cycle, week, day, exIdx, totalSets){
      let prevCycle=cycle, prevWeek=week-1;
      if(prevWeek<1){ prevCycle=cycle-1; prevWeek=12; }
      if(prevCycle<1) return true;
      const perf=getExercisePerformance(prevCycle,prevWeek,day,exIdx,totalSets);
      return perf.completed===totalSets;
    }

    function computeWeight(startWeight, cycle, week, day, exIdx, totalSets){
      if(!startWeight) return 0;
      try{
        const weekType=getWeekType(week);
        const saved=DataStore.getSavedWeight(cycle,week,day,exIdx);
        if(saved!==null) return (weekType==='deload')?Math.round(saved*0.7):saved;
        if(cycle===1 && week===1){ DataStore.saveWeight(cycle,week,day,exIdx,startWeight); return startWeight; }
        let prevCycle=cycle, prevWeek=week-1;
        if(prevWeek<1){ prevCycle=cycle-1; prevWeek=12; }
        if(prevCycle<1){ DataStore.saveWeight(cycle,week,day,exIdx,startWeight); return startWeight; }
        const prevWeight=computeWeight(startWeight,prevCycle,prevWeek,day,exIdx,totalSets);
        const manualAdj=DataStore.getAdjustment(prevCycle,prevWeek,day,exIdx);
        let newWeight=prevWeight;
        if(manualAdj!==null) newWeight=prevWeight+manualAdj;
        else { const prevWeekType=getWeekType(prevWeek); const completedLast=didCompleteLastWeek(cycle,week,day,exIdx,totalSets); if(completedLast && prevWeekType!=='deload') newWeight+=5; }
        DataStore.saveWeight(cycle,week,day,exIdx,newWeight);
        return (weekType==='deload')?Math.round(newWeight*0.7):newWeight;
      }catch{return startWeight;}
    }

    /* ---------- UI ---------- */
    const UI=(function(){
      const dom={
        cycleInfo: document.getElementById('cycleInfo'),
        weekSelector: document.getElementById('weekSelector'),
        weekAlert: document.getElementById('weekAlert'),
        grid: document.getElementById('workoutGrid'),
        detail: document.getElementById('workoutDetail'),
        exportBtn: document.getElementById('exportBtn'),
        resetBtn: document.getElementById('resetBtn')
      };

      function clearChildren(el){ while(el.firstChild) el.removeChild(el.firstChild); }
      function renderCycleInfo(cycle, week){ dom.cycleInfo.textContent=`Cycle ${cycle} — Week ${week} of 12 (${getWeekType(week)})`; }
      function renderWeekSelector(currentWeek){
        clearChildren(dom.weekSelector);
        for(let w=1;w<=12;w++){
          const btn=document.createElement('button');
          btn.type='button'; btn.className='week-btn'; btn.textContent='Week '+w;
          if(getWeekType(w)==='deload') btn.classList.add('deload');
          if(w===currentWeek) btn.classList.add('active');
          btn.dataset.week=w;
          btn.addEventListener('click', e=>{ const week=parseInt(e.currentTarget.dataset.week,10); currentWeek=week; DataStore.setWeek(week); selectedDay=null; render(); });
          dom.weekSelector.appendChild(btn);
        }
      }

      function renderDaysGrid(cycle, week){
        clearChildren(dom.grid);
        const days=Object.keys(PROGRAM).map(k=>parseInt(k,10)).sort((a,b)=>a-b);
        days.forEach(day=>{
          const def=PROGRAM[day];
          const card=document.createElement('div'); card.className='card day-card'; card.tabIndex=0; card.dataset.day=day;
          card.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center"><strong>Day ${day}</strong><span class="muted small">${def.name}</span></div><div class="small muted" style="margin-top:8px">${def.exercises.length} exercises</div>`;
          card.addEventListener('click',()=>selectDay(day));
          card.addEventListener('keydown',ev=>{ if(ev.key==='Enter'||ev.key===' '){ ev.preventDefault(); selectDay(day); } });
          dom.grid.appendChild(card);
        });
      }

      function renderWorkoutDetail(cycle, week, day){
        if(!day){ dom.detail.classList.add('hidden'); dom.detail.innerHTML=''; return; }
        dom.detail.classList.remove('hidden'); clearChildren(dom.detail);
        const def=PROGRAM[day];
        const heading=document.createElement('div');
        heading.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center"><div><strong>Day ${day} — ${def.name}</strong><div class="muted small">${def.exercises.length} exercises</div></div><div class="muted small">Week ${week} (${getWeekType(week)})</div></div>`;
        dom.detail.appendChild(heading);

        def.exercises.forEach((ex,idx)=>{
          const exIdx=idx+1;
          const exCard=document.createElement('div'); exCard.className='exercise-card';
          const weight=computeWeight(ex.startWeight,cycle,week,day,exIdx,ex.sets);
          const perf=getExercisePerformance(cycle,week,day,exIdx,ex.sets);
          exCard.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:flex-start"><div><div style="font-weight:700">${ex.name}</div><div class="muted small">${ex.notes||''}</div></div><div style="text-align:right"><div style="font-weight:700">${weight} lbs</div><div class="muted small">Sets ${perf.completed}/${perf.total}</div></div></div><div style="margin-top:10px" id="ex_${day}_${exIdx}"></div>`;
          dom.detail.appendChild(exCard);
          const placeholder=exCard.querySelector(`#ex_${day}_${exIdx}`);
          const setRow=document.createElement('div'); setRow.className='set-buttons';
          for(let s=1;s<=ex.sets;s++){
            const b=document.createElement('button'); b.type='button'; b.className='set-btn'; b.textContent=`Set ${s}`;
            const state=DataStore.getProgress(cycle,week,day,exIdx,s);
            if(state==='complete') b.classList.add('complete');
            else if(state==='failed') b.classList.add('failed');
            b.addEventListener('click',()=>{ const cur=DataStore.getProgress(cycle,week,day,exIdx,s); const next=cur===null?'complete':(cur==='complete'?'failed':null); if(next===null) localStorage.removeItem('prog_v1_' + ['p',cycle,week,day,exIdx,'s'+s].join('|')); else DataStore.saveProgress(cycle,week,day,exIdx,s,next); renderWorkoutDetail(cycle,week,day); renderDaysGrid(cycle,week); });
            setRow.appendChild(b);
          }
          placeholder.appendChild(setRow);
        });
      }

      function setAlert(text,show=true){ if(!text||!show){ dom.weekAlert.classList.add('hidden'); dom.weekAlert.textContent=''; return; } dom.weekAlert.classList.remove('hidden'); dom.weekAlert.textContent=text; }
      function selectDay(day){ selectedDay=day; document.querySelectorAll('.day-card').forEach(el=>el.dataset.day==day?el.classList.add('selected'):el.classList.remove('selected')); renderWorkoutDetail(currentCycle,currentWeek,day); }

      // export/reset
      dom.exportBtn.addEventListener('click',()=>{
        const csv=DataStore.exportCSV(); const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='workout-export.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
      });
      dom.resetBtn.addEventListener('click',()=>{ if(!confirm('Reset all saved program data?')) return; DataStore.resetAll(); location.reload(); });

      return { renderCycleInfo, renderWeekSelector, renderDaysGrid, renderWorkoutDetail, setAlert, selectDay };
    })();

    /* ---------- App ---------- */
    let currentCycle=DataStore.getCycle();
    let currentWeek=DataStore.getWeek();
    let selectedDay=null;

    function render(){ try{ UI.renderCycleInfo(currentCycle,currentWeek); UI.renderWeekSelector(currentWeek); UI.renderDaysGrid(currentCycle,currentWeek); UI.renderWorkoutDetail(currentCycle,currentWeek,selectedDay); UI.setAlert('',false); }catch(err){ console.error(err); UI.setAlert('Render error'); } }

    window.selectDay=UI.selectDay;

    render();
    window._workoutApp={DataStore,UI,PROGRAM,get state(){return{cycle:currentCycle,week:currentWeek,selectedDay}},render};

  })();
  </script>
</body>
</html>
