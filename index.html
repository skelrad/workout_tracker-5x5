<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Progressive 5x5 — Manual Weights</title>
<style>
:root{
  --accent:#3b82f6;
  --muted:#6b7280;
  --success:#10b981;
  --danger:#ef4444;
  --split-left: rgba(16,185,129,0.12);
  --split-right: rgba(239,68,68,0.12);
}
*{box-sizing:border-box}
body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;background:#f5f5f5;margin:0;padding:20px;color:#111}
.container{max-width:1100px;margin:0 auto}
.card{background:#fff;padding:18px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.06);margin-bottom:18px}
h1{font-size:1.4rem;margin:0 0 6px}
p.lead{margin:0;color:var(--muted)}
.controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
.week-selector{display:flex;gap:8px;flex-wrap:wrap}
.week-btn{padding:8px 12px;border-radius:8px;border:2px solid #ddd;background:#fff;font-weight:600;cursor:pointer}
.week-btn:hover{background:#f3f4f6}
.week-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}
.week-btn.deload{background:#fef3c7;border-color:#fbbf24}
.week-btn.deload.active{background:#fbbf24;color:#78350f}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
.day-card{padding:14px;border-radius:8px;border:2px solid transparent;cursor:pointer}
.day-card:hover{transform:translateY(-4px);transition:transform .12s}
.day-card.selected{border-color:var(--accent);background:#eff6ff}
.exercise-card{padding:12px;border-radius:8px;border:1px solid #e6e6e6;margin-bottom:10px;background:#fafafa}
.set-buttons{display:flex;gap:8px;flex-wrap:wrap}
.set-btn{
  position:relative;
  padding:8px 10px;
  border-radius:8px;
  border:1px solid #d1d5db;
  background:#fff;
  cursor:pointer;
  min-width:64px;
  user-select:none;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}
.set-btn .half{display:inline-block;width:50%;text-align:center;padding:6px 8px;pointer-events:none}
.set-btn .half.left{background:var(--split-left);}
.set-btn .half.right{background:var(--split-right);}
.set-btn.pass{background:var(--success);border-color:var(--success);color:#fff}
.set-btn.fail{background:var(--danger);border-color:var(--danger);color:#fff}
.set-btn:hover{transform:translateY(-2px);transition:transform .08s}
.adjust-btn{padding:6px 8px;border-radius:6px;border:1px solid #d1d5db;background:#fff;cursor:pointer}
.adjust-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}
.adjust-clear{background:#fff;border:1px solid #ef4444;color:#ef4444;padding:6px 8px;border-radius:6px;cursor:pointer}
.hidden{display:none}
.muted{color:var(--muted);font-size:.95rem}
.flex{display:flex;gap:12px;align-items:center}
.spacer{flex:1}
.small{font-size:.9rem}
.alert{padding:12px;border-radius:8px;background:#dbeafe;border-left:4px solid var(--accent);margin-bottom:14px}
footer{margin-top:18px;text-align:center;color:var(--muted);font-size:0.9rem}
@media print{.controls,button{display:none}}
</style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Progressive 5x5 — Manual Weights</h1>
      <p class="lead">All progression is manual. Use the adjustment buttons to set the next week's baseline.</p>
      <div id="cycleInfo" class="muted small" style="margin-top:10px"></div>
    </div>

    <div class="card controls" aria-label="controls">
      <div>
        <strong>Select Week</strong>
        <div id="weekSelector" class="week-selector" aria-label="week selector"></div>
      </div>

      <div class="spacer"></div>

      <div style="min-width:220px;text-align:right">
        <button id="exportBtn" class="week-btn" title="Export CSV">Download CSV</button>
        <button id="resetBtn" class="week-btn" title="Reset progress">Reset</button>
      </div>
    </div>

    <div id="weekAlert" class="alert hidden" role="status"></div>
    <div id="workoutGrid" class="grid"></div>
    <div id="workoutDetail" class="card hidden" aria-live="polite"></div>

    <footer class="muted">Data stored locally in your browser (localStorage).</footer>
  </div>

<script>
(function(){
  'use strict';

  /* ---------- PROGRAM (full) ---------- */
  const PROGRAM = {
    1: { name: "Upper Body Push", exercises: [
      { name:"Incline Dumbbell Press", sets:5, startWeight:25, notes:"Focus on upper chest" },
      { name:"Standing Overhead Press", sets:5, startWeight:20, notes:"Strict form" },
      { name:"Dumbbell Floor Press", sets:5, startWeight:30, notes:"Protect shoulders" },
      { name:"Lateral Raises", sets:3, startWeight:10, notes:"Slight bend in elbow" },
      { name:"Overhead Tricep Extension", sets:3, startWeight:20, notes:"Single DB, both arms" }
    ]},
    2: { name: "Lower Body", exercises: [
      { name:"Goblet Squats", sets:5, startWeight:40, notes:"Hold one DB at chest" },
      { name:"Romanian Deadlifts", sets:5, startWeight:30, notes:"Hinge at hips" },
      { name:"Bulgarian Split Squats", sets:4, startWeight:20, notes:"Each leg" },
      { name:"Dumbbell Lunges", sets:3, startWeight:20, notes:"Each leg, walking" },
      { name:"Calf Raises", sets:3, startWeight:30, notes:"On step, hold DBs" }
    ]},
    3: { name: "Cardio & Core", exercises: [
      { name:"Treadmill Intervals", sets:1, startWeight:0, notes:"20 min total" },
      { name:"Plank", sets:3, startWeight:0, notes:"Hold 30-60s" },
      { name:"Russian Twists", sets:3, startWeight:15, notes:"One DB" },
      { name:"Dumbbell Side Bends", sets:3, startWeight:25, notes:"Each side" },
      { name:"Lying Leg Raises", sets:3, startWeight:0, notes:"Slow and controlled" }
    ]},
    4: { name: "Upper Body Pull", exercises: [
      { name:"Bent Over Rows", sets:5, startWeight:35, notes:"Pull to hip" },
      { name:"Single Arm Row", sets:4, startWeight:40, notes:"Each arm" },
      { name:"Dumbbell Pullover", sets:4, startWeight:30, notes:"Chest/back combo" },
      { name:"Hammer Curls", sets:4, startWeight:20, notes:"Neutral grip" },
      { name:"Reverse Flyes", sets:3, startWeight:12, notes:"Rear delts" }
    ]},
    5: { name: "Full Body & Cardio", exercises: [
      { name:"Dumbbell Clean & Press", sets:4, startWeight:25, notes:"Explosive" },
      { name:"Goblet Squats", sets:4, startWeight:40, notes:"Similar to Day 2" },
      { name:"Push-ups", sets:3, startWeight:0, notes:"On knees if needed" },
      { name:"Dumbbell Swings", sets:3, startWeight:30, notes:"Hip drive" },
      { name:"Treadmill Intervals", sets:1, startWeight:0, notes:"15 min" }
    ]}
  };

  /* ---------- DataStore (manual weights only) ---------- */
  const prefix = 'prog_manual_v1_';
  function key(...parts){ return prefix + parts.join('|'); }

  const DataStore = {
    getWeek(){ return parseInt(localStorage.getItem(key('week')) || '1', 10); },
    setWeek(w){ localStorage.setItem(key('week'), String(w)); },
    // progress per set (complete/failed)
    saveProgress(week, day, exIdx, setNum, value){ localStorage.setItem(key('p', week, day, exIdx, 's' + setNum), value); },
    getProgress(week, day, exIdx, setNum){ return localStorage.getItem(key('p', week, day, exIdx, 's' + setNum)) || null; },
    removeProgress(week, day, exIdx, setNum){ localStorage.removeItem(key('p', week, day, exIdx, 's' + setNum)); },
    // saved weight for a specific week/day/ex (absolute baseline)
    saveWeight(week, day, exIdx, weight){ localStorage.setItem(key('w', week, day, exIdx), String(weight)); },
    getSavedWeight(week, day, exIdx){ const v = localStorage.getItem(key('w', week, day, exIdx)); return v !== null ? parseFloat(v) : null; },
    removeSavedWeight(week, day, exIdx){ localStorage.removeItem(key('w', week, day, exIdx)); },
    // next-week adjustment saved as absolute weight (we'll store weight for nextWeek)
    saveNextWeight(nextWeek, day, exIdx, weight){ localStorage.setItem(key('w', nextWeek, day, exIdx), String(weight)); },
    // export/reset
    exportCSV(){
      const rows=[['key','value']];
      for(let i=0;i<localStorage.length;i++){
        const k = localStorage.key(i);
        if(k && k.startsWith(prefix)) rows.push([k, localStorage.getItem(k)]);
      }
      return rows.map(r=>r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
    },
    resetAll(){
      const toRemove = [];
      for(let i=0;i<localStorage.length;i++){
        const k = localStorage.key(i);
        if(k && k.startsWith(prefix)) toRemove.push(k);
      }
      toRemove.forEach(k => localStorage.removeItem(k));
    }
  };

  /* ---------- UI helpers ---------- */
  const dom = {
    cycleInfo: document.getElementById('cycleInfo'),
    weekSelector: document.getElementById('weekSelector'),
    grid: document.getElementById('workoutGrid'),
    detail: document.getElementById('workoutDetail'),
    exportBtn: document.getElementById('exportBtn'),
    resetBtn: document.getElementById('resetBtn'),
    weekAlert: document.getElementById('weekAlert')
  };

  function clear(el){ while(el.firstChild) el.removeChild(el.firstChild); }

  function getDisplayedWeight(week, day, exIdx, startWeight){
    // If a saved weight exists for this week, use it. Else fallback to startWeight.
    const saved = DataStore.getSavedWeight(week, day, exIdx);
    return saved !== null ? saved : startWeight;
  }

  function renderWeekSelector(currentWeek){
    clear(dom.weekSelector);
    for(let w=1; w<=12; w++){
      const btn = document.createElement('button');
      btn.type='button'; btn.className='week-btn'; btn.textContent='Week ' + w;
      if (w === currentWeek) btn.classList.add('active');
      if (w % 4 === 0) btn.classList.add('deload');
      btn.dataset.week = String(w);
      btn.addEventListener('click', ()=>{ DataStore.setWeek(w); render(); });
      dom.weekSelector.appendChild(btn);
    }
  }

  function renderDaysGrid(){
    clear(dom.grid);
    const days = Object.keys(PROGRAM).map(k => parseInt(k,10)).sort((a,b)=>a-b);
    days.forEach(day => {
      const def = PROGRAM[day];
      const card = document.createElement('div');
      card.className = 'card day-card';
      card.tabIndex = 0;
      card.dataset.day = String(day);
      card.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><strong>Day ${day}</strong><span class="muted small">${def.name}</span></div><div class="small muted" style="margin-top:8px">${def.exercises.length} exercises</div>`;
      card.addEventListener('click', ()=> selectDay(day));
      card.addEventListener('keydown', ev=>{ if(ev.key === 'Enter' || ev.key === ' '){ ev.preventDefault(); selectDay(day); } });
      dom.grid.appendChild(card);
    });
  }

  /* ---------- Render workout & interactive controls ---------- */
  function renderWorkoutDetail(week, day){
    if(!day){ dom.detail.classList.add('hidden'); dom.detail.innerHTML = ''; return; }
    dom.detail.classList.remove('hidden');
    clear(dom.detail);

    const def = PROGRAM[day];
    const heading = document.createElement('div');
    heading.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center">
      <div><strong>Day ${day} — ${def.name}</strong><div class="muted small">${def.exercises.length} exercises</div></div>
      <div class="muted small">Week ${week}</div>
    </div>`;
    dom.detail.appendChild(heading);

    def.exercises.forEach((ex, idx) => {
      const exIdx = idx + 1;
      const exCard = document.createElement('div');
      exCard.className = 'exercise-card';

      const displayedWeight = getDisplayedWeight(week, day, exIdx, ex.startWeight);
      exCard.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:flex-start">
        <div>
          <div style="font-weight:700">${ex.name}</div>
          <div class="muted small">${ex.notes || ''}</div>
        </div>
        <div style="text-align:right">
          <div style="font-weight:700">${displayedWeight} lbs</div>
        </div>
      </div>
      <div style="margin-top:10px" id="ex_${day}_${exIdx}"></div>`;

      dom.detail.appendChild(exCard);

      // set buttons placeholder
      const placeholder = exCard.querySelector(`#ex_${day}_${exIdx}`);
      // set button row
      const setRow = document.createElement('div');
      setRow.className = 'set-buttons';
      for(let s=1; s<=ex.sets; s++){
        const b = document.createElement('button');
        b.type='button'; b.className='set-btn';
        // two visual halves
        const left = document.createElement('span'); left.className='half left'; left.textContent = '✓';
        const right = document.createElement('span'); right.className='half right'; right.textContent = '✗';
        b.appendChild(left); b.appendChild(right);

        // set initial style based on saved progress for this week
        const state = DataStore.getProgress(week, day, exIdx, s);
        if(state === 'complete') b.classList.add('pass');
        else if(state === 'failed') b.classList.add('fail');

        // click logic: left half = pass, right half = fail, double-click clears
        b.addEventListener('click', function(ev){
          const rect = b.getBoundingClientRect();
          const clickX = ev.clientX - rect.left;
          const half = rect.width / 2;
          // double-click clears
          if (ev.detail === 2){
            DataStore.removeProgress(week, day, exIdx, s);
            b.classList.remove('pass','fail');
            return;
          }
          if (clickX < half){
            DataStore.saveProgress(week, day, exIdx, s, 'complete');
            b.classList.remove('fail'); b.classList.add('pass');
          } else {
            DataStore.saveProgress(week, day, exIdx, s, 'failed');
            b.classList.remove('pass'); b.classList.add('fail');
          }
        });

        setRow.appendChild(b);
      }
      placeholder.appendChild(setRow);

      // weight adjustment area (for next week)
      const adjWrap = document.createElement('div');
      adjWrap.style.marginTop = '12px';
      adjWrap.innerHTML = `<div style="font-weight:700;margin-bottom:8px">Weight change for next week</div>`;

      // show what is currently planned for next week (if any)
      const nextWeek = (week % 12) + 1;
      const plannedNext = DataStore.getSavedWeight(nextWeek, day, exIdx);
      const plannedRow = document.createElement('div');
      plannedRow.className = 'muted small';
      plannedRow.style.marginBottom = '6px';
      plannedRow.textContent = 'Planned next-week weight: ' + (plannedNext !== null ? plannedNext + ' lbs' : 'none');
      adjWrap.appendChild(plannedRow);

      // adjustment buttons
      const btnRow = document.createElement('div');
      btnRow.style.display = 'flex';
      btnRow.style.gap = '8px';
      const deltas = [10,5,3,0,-3,-5];
      deltas.forEach(delta => {
        const btn = document.createElement('button');
        btn.type='button';
        btn.className='adjust-btn';
        btn.textContent = (delta > 0 ? '+'+delta : String(delta));
        // active if plannedNext equals displayedWeight+delta
        if (plannedNext !== null && Math.round(plannedNext) === Math.round(displayedWeight + delta)){
          btn.classList.add('active');
        }
        btn.addEventListener('click', ()=>{
          // Save absolute weight for nextWeek as displayedWeight + delta
          const nextWeight = Math.round(displayedWeight + delta);
          DataStore.saveNextWeight(nextWeek, day, exIdx, nextWeight);
          render(); // re-render so plannedNext updates and active state shows
        });
        btnRow.appendChild(btn);
      });

      // clear button for next-week plan
      const clr = document.createElement('button');
      clr.type='button';
      clr.className='adjust-clear';
      clr.textContent = 'Clear';
      clr.addEventListener('click', ()=>{
        DataStore.removeSavedWeight(nextWeek, day, exIdx);
        render();
      });
      btnRow.appendChild(clr);

      adjWrap.appendChild(btnRow);
      placeholder.appendChild(adjWrap);
    });
  }

  /* ---------- small DataStore helpers for next-week weight keys ---------- */
  // provide wrappers for savedWeight keyed by week, day, exIdx
  DataStore.getSavedWeight = function(week, day, exIdx){
    const v = localStorage.getItem(key('w', week, day, exIdx));
    return v !== null ? parseFloat(v) : null;
  };
  DataStore.saveNextWeight = function(nextWeek, day, exIdx, weight){
    localStorage.setItem(key('w', nextWeek, day, exIdx), String(weight));
  };
  DataStore.removeSavedWeight = function(week, day, exIdx){
    localStorage.removeItem(key('w', week, day, exIdx));
  };

  /* ---------- render glue ---------- */
  function render(){
    const week = DataStore.getWeek();
    dom.cycleInfo.textContent = `Week ${week}`;
    renderWeekSelector(week);
    renderDaysGrid();
    // keep selectedDay visible if previously selected
    if (window._selectedDay) renderWorkoutDetail(week, window._selectedDay);
    else dom.detail.classList.add('hidden');
  }

  // render week selector and grid functions
  function renderWeekSelector(currentWeek){
    clear(dom.weekSelector);
    for(let w=1; w<=12; w++){
      const btn = document.createElement('button');
      btn.type='button'; btn.className='week-btn'; btn.textContent = 'Week ' + w;
      if (w === currentWeek) btn.classList.add('active');
      if (w % 4 === 0) btn.classList.add('deload');
      btn.addEventListener('click', ()=>{ DataStore.setWeek(w); render(); });
      dom.weekSelector.appendChild(btn);
    }
  }

  function renderDaysGrid(){
    clear(dom.grid);
    const days = Object.keys(PROGRAM).map(k=>parseInt(k,10)).sort((a,b)=>a-b);
    days.forEach(day => {
      const def = PROGRAM[day];
      const card = document.createElement('div');
      card.className = 'card day-card';
      card.tabIndex = 0;
      card.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Day ${day}</strong><span class="muted small">${def.name}</span>
      </div><div class="small muted" style="margin-top:8px">${def.exercises.length} exercises</div>`;
      card.addEventListener('click', ()=> selectDay(day));
      card.addEventListener('keydown', ev=>{ if(ev.key==='Enter' || ev.key===' '){ ev.preventDefault(); selectDay(day); } });
      dom.grid.appendChild(card);
    });
  }

  // select day helper (keeps state globally for re-render)
  function selectDay(day){
    window._selectedDay = day;
    const week = DataStore.getWeek();
    renderWorkoutDetail(week, day);
    // visually mark selected
    document.querySelectorAll('.day-card').forEach(el=>{
      if (el.textContent.includes('Day '+day)) el.classList.add('selected'); else el.classList.remove('selected');
    });
  }

  // export/reset
  dom.exportBtn.addEventListener('click', ()=>{
    const csv = DataStore.exportCSV();
    const blob = new Blob([csv], {type:'text/csv'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
    a.download = 'workout-export.csv'; document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(a.href);
  });

  dom.resetBtn.addEventListener('click', ()=>{
    if (!confirm('Reset all saved program data? This cannot be undone.')) return;
    DataStore.resetAll();
    window._selectedDay = null;
    render();
  });

  // initial week default
  if (!localStorage.getItem(key('week'))) DataStore.setWeek(1);

  // initial render
  render();

  // expose for debugging
  window._workoutApp = { DataStore, PROGRAM, render };

})();
</script>
</body>
</html>
