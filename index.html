<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Workout Tracker Pro v5</title>
<style>
:root{--accent:#3b82f6;--muted:#6b7280;--success:#10b981;--danger:#ef4444;--deload:#fbbf24;--bg:#f8fafc;--card:#fff;--border:#e2e8f0}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:system-ui,-apple-system,sans-serif;background:var(--bg);color:#1e293b;line-height:1.5;padding:16px}
.container{max-width:800px;margin:0 auto}
.card{background:var(--card);padding:20px;border-radius:16px;box-shadow:0 4px 6px -1px rgba(0,0,0,.1);margin-bottom:16px}
.btn{padding:10px 18px;border-radius:10px;border:none;font-weight:600;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:8px}
.btn-primary{background:var(--accent);color:#fff}
.btn-secondary{background:#f1f5f9;color:#475569}
.btn-danger{background:var(--danger);color:#fff}
.btn-sm{padding:6px 12px;font-size:.85rem}
.input{padding:8px 12px;border:1px solid var(--border);border-radius:8px;width:100%;font-size:1rem}
.nav{display:flex;gap:12px;margin-bottom:20px;background:#e2e8f0;padding:4px;border-radius:12px}
.nav-btn{flex:1;padding:10px;border:none;font-weight:600;cursor:pointer;color:#64748b;border-radius:8px;background:none}
.nav-btn.active{background:#fff;color:var(--accent);box-shadow:0 2px 4px rgba(0,0,0,.05)}
.day-setup{border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:12px;background:#fff}
.ex-card{border:1px solid var(--border);border-radius:10px;padding:12px;margin-bottom:8px;background:#f8fafc;cursor:grab}
.ex-card:active{cursor:grabbing}
.week-btn{padding:10px;border-radius:10px;border:1px solid var(--border);background:#fff;font-weight:600;cursor:pointer;min-width:60px;text-align:center}
.week-btn.active{background:var(--accent);color:#fff}
.day-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px}
.day-card{border:1px solid var(--border);border-radius:16px;padding:20px;cursor:pointer;background:#fff}
.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(15,23,42,0.6);display:flex;align-items:center;justify-content:center;z-index:1000;backdrop-filter:blur(4px)}
.modal-content{background:#fff;border-radius:20px;padding:24px;max-width:500px;width:90%;max-height:85vh;overflow-y:auto}
.template-item{border:1px solid var(--border);border-radius:12px;padding:12px;margin-bottom:8px;cursor:pointer}
.row{display:flex;gap:8px;align-items:center;margin-top:8px}
.label-small{font-size:0.75rem;color:var(--muted);font-weight:600;display:block;margin-bottom:2px}
</style>
</head>
<body>
<div class="container">
    <header style="margin-bottom:24px">
        <h1 style="font-size:1.5rem">Workout Tracker <span style="color:var(--accent)">Pro</span></h1>
    </header>
    <div class="nav">
        <button class="nav-btn active" id="setupTab">‚öôÔ∏è Setup</button>
        <button class="nav-btn" id="workoutTab">üí™ Workout</button>
    </div>
    <div id="app"></div>
</div>

<script>
const KEY = 'WT_PRO_V5';
const App = {
    t: { n: 'My Program', w: 8, de: 4, dp: 70, days: {} },
    p: {}, cw: 1, view: 'setup', expanded: new Set(),
    draggingIdx: null, draggingDay: null
};

const S = {
    save() {
        localStorage.setItem(KEY + '_t', JSON.stringify(App.t));
        localStorage.setItem(KEY + '_p', JSON.stringify(App.p));
        localStorage.setItem(KEY + '_cw', App.cw);
    },
    load() {
        const t = localStorage.getItem(KEY + '_t');
        const p = localStorage.getItem(KEY + '_p');
        const w = localStorage.getItem(KEY + '_cw');
        if (t) App.t = JSON.parse(t);
        if (p) App.p = JSON.parse(p);
        if (w) App.cw = parseInt(w) || 1;
    }
};

const TEMPLATES = {
    forty_plus_hypertrophy: {
        n: "40+ Muscle & Vitality", w: 8, de: 4, dp: 70,
        days: {
            1: { n: "Full Body + Chest/Arms Focus", ex: [
                {n:"DB Goblet Squats", s:3, r:"12", w:1},
                {n:"BW Push-ups", s:3, r:"AMRAP", a:1},
                {n:"DB Single Arm Rows", s:3, r:"10", w:1},
                {n:"DB Floor Press", s:3, r:"12", w:1},
                {n:"DB Hammer Curls", s:2, r:"12", w:1}
            ]},
            2: { n: "Zone 2 Cardio Recovery", rest: 1 },
            3: { n: "Full Body + Back/Shoulder Focus", ex: [
                {n:"DB Romanian Deadlift", s:3, r:"12", w:1},
                {n:"DB Overhead Press", s:3, r:"10", w:1},
                {n:"DB Chest-Supported Row", s:3, r:"12", w:1},
                {n:"DB Lateral Raises", s:3, r:"15", w:1},
                {n:"DB Bicep Curls", s:2, r:"12", w:1}
            ]},
            4: { n: "Mobility & Walking", rest: 1 },
            5: { n: "Full Body Capacity", ex: [
                {n:"DB Thrusters", s:3, r:"12", w:1},
                {n:"DB Renegade Rows", s:3, r:"10", w:1},
                {n:"DB Incline Press", s:3, r:"12", w:1},
                {n:"DB Tricep Extensions", s:3, r:"12", w:1}
            ]}
        }
    }
};

const EX_LIB = {
    "Chest/Push": ["DB Floor Press", "DB Overhead Press", "Push-ups", "DB Incline Press", "Lateral Raises"],
    "Back/Pull": ["DB Row", "Single Arm Row", "Hammer Curls", "Bicep Curls", "Renegade Row"],
    "Legs": ["Goblet Squat", "Romanian Deadlift", "Split Squat", "Step-ups", "Lunges"],
    "Core": ["Plank", "Dead Bug", "Russian Twist", "Mountain Climbers"]
};

function r() {
    const root = document.getElementById('app');
    if (App.view === 'setup') rSetup(root);
    else rWorkout(root);
    S.save();
}

function rSetup(root) {
    const daysArr = Object.keys(App.t.days).map(Number).sort((a,b)=>a-b);
    root.innerHTML = `
        <div class="card">
            <button class="btn btn-secondary btn-sm" onclick="showTemplates()" style="float:right">üìã Templates</button>
            <h3>Program Info</h3>
            <div style="margin-top:12px">
                <label class="label-small">Program Name</label>
                <input class="input" value="${App.t.n}" oninput="App.t.n=this.value">
            </div>
        </div>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <h2>Days</h2>
            <button class="btn btn-primary btn-sm" onclick="addDay()">+ Add Day</button>
        </div>

        ${daysArr.map(d => {
            const day = App.t.days[d];
            const isOpen = App.expanded.has(d);
            return `
            <div class="day-setup">
                <div style="display:flex;justify-content:space-between;cursor:pointer" onclick="toggleExpand(${d})">
                    <strong>Day ${d}: ${day.n || 'Rest'}</strong>
                    <span>${isOpen ? '‚ñ≤' : '‚ñº'}</span>
                </div>
                
                ${isOpen ? `
                    <div style="margin-top:15px">
                        <label class="label-small">Day Name</label>
                        <input class="input" value="${day.n}" oninput="App.t.days[${d}].n=this.value">
                        <label style="display:block;margin:10px 0"><input type="checkbox" ${day.rest?'checked':''} onchange="App.t.days[${d}].rest=this.checked; r()"> Rest Day</label>
                        
                        ${!day.rest ? `
                            <div ondragover="event.preventDefault()" ondrop="dropEx(event, ${d})">
                                ${(day.ex || []).map((e, i) => `
                                    <div class="ex-card" draggable="true" ondragstart="dragEx(event, ${d}, ${i})">
                                        <div style="display:flex;justify-content:space-between;margin-bottom:8px">
                                            <input class="input" style="font-weight:bold; border:none; padding:2px; background:transparent" value="${e.n}" oninput="App.t.days[${d}].ex[${i}].n=this.value">
                                            <button class="btn btn-danger btn-sm" onclick="delEx(${d}, ${i})">‚úï</button>
                                        </div>
                                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px">
                                            <div>
                                                <label class="label-small">Sets</label>
                                                <input type="number" class="input" value="${e.s}" oninput="App.t.days[${d}].ex[${i}].s=parseInt(this.value)||0">
                                            </div>
                                            <div>
                                                <label class="label-small">Reps</label>
                                                <input class="input" value="${e.r}" oninput="App.t.days[${d}].ex[${i}].r=this.value">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <label style="font-size:0.8rem"><input type="checkbox" ${e.w?'checked':''} onchange="App.t.days[${d}].ex[${i}].w=this.checked"> Track Weight</label>
                                            <label style="font-size:0.8rem"><input type="checkbox" ${e.a?'checked':''} onchange="App.t.days[${d}].ex[${i}].a=this.checked"> AMRAP</label>
                                        </div>
                                    </div>
                                `).join('')}
                                <button class="btn btn-secondary btn-sm" style="width:100%" onclick="showExLib(${d})">+ Add Exercise</button>
                            </div>
                        ` : ''}
                        <button class="btn btn-danger btn-sm" style="margin-top:10px; width:100%" onclick="delDay(${d})">Delete Day</button>
                    </div>
                ` : ''}
            </div>
            `
        }).join('')}
    `;
}

function rWorkout(root) {
    const daysArr = Object.keys(App.t.days).map(Number).sort((a,b)=>a-b);
    root.innerHTML = `
        <div class="card">
            <h3>Week ${App.cw}</h3>
            <div style="display:flex;gap:8px;overflow-x:auto;padding-top:12px">
                ${Array.from({length:App.t.w},(_,i)=>i+1).map(w=>`
                    <div class="week-btn ${w===App.cw?'active':''}" onclick="App.cw=${w};r()">${w}</div>
                `).join('')}
            </div>
        </div>
        <div class="day-grid">
            ${daysArr.map(d => `
                <div class="day-card" onclick="alert('Starting Day ${d}')">
                    <h4>Day ${d}</h4>
                    <p style="color:var(--muted)">${App.t.days[d].n || (App.t.days[d].rest ? 'Rest' : 'Workout')}</p>
                </div>
            `).join('')}
        </div>
    `;
}

function toggleExpand(d) {
    const id = Number(d);
    App.expanded.has(id) ? App.expanded.delete(id) : App.expanded.add(id);
    r();
}

function addDay() {
    const newId = Math.max(0, ...Object.keys(App.t.days).map(Number)) + 1;
    App.t.days[newId] = { n: 'New Workout', ex: [], rest: false };
    App.expanded.add(newId);
    r();
}

function delDay(d) { if(confirm('Delete?')) { delete App.t.days[d]; r(); } }

function showExLib(d) {
    const ov = document.createElement('div');
    ov.className = 'modal-overlay';
    ov.innerHTML = `<div class="modal-content"><h3>Exercises</h3>${Object.keys(EX_LIB).map(c=>`
        <div style="margin-top:10px;font-weight:bold">${c}</div>
        ${EX_LIB[c].map(e=>`<div class="template-item" onclick="addExToDay(${d},'${e}')">${e}</div>`).join('')}
    `).join('')}<button class="btn btn-secondary" style="width:100%" onclick="this.closest('.modal-overlay').remove()">Close</button></div>`;
    document.body.appendChild(ov);
}

function addExToDay(d, n) {
    App.t.days[d].ex.push({n, s:3, r:"10", w:1, a:0});
    document.querySelector('.modal-overlay').remove();
    r();
}

function delEx(d, i) { App.t.days[d].ex.splice(i,1); r(); }

function dragEx(e, d, i) { App.draggingDay = d; App.draggingIdx = i; }
function dropEx(e, d) {
    if (App.draggingDay !== d) return;
    const items = App.t.days[d].ex;
    const moving = items.splice(App.draggingIdx, 1)[0];
    items.push(moving); // Simplistic drop-at-end for this snippet
    r();
}

function showTemplates() {
    const ov = document.createElement('div');
    ov.className = 'modal-overlay';
    ov.innerHTML = `<div class="modal-content"><h3>Load Template</h3>${Object.keys(TEMPLATES).map(k=>`
        <div class="template-item" onclick="loadT('${k}')"><strong>${TEMPLATES[k].n}</strong></div>
    `).join('')}<button class="btn btn-secondary" style="width:100%" onclick="this.closest('.modal-overlay').remove()">Cancel</button></div>`;
    document.body.appendChild(ov);
}

function loadT(k) {
    if(confirm('Replace current program?')) {
        App.t = JSON.parse(JSON.stringify(TEMPLATES[k]));
        App.expanded.clear();
        document.querySelector('.modal-overlay').remove();
        r();
    }
}

document.getElementById('setupTab').onclick = () => { App.view = 'setup'; setupTab.classList.add('active'); workoutTab.classList.remove('active'); r(); };
document.getElementById('workoutTab').onclick = () => { App.view = 'workout'; workoutTab.classList.add('active'); setupTab.classList.remove('active'); r(); };

S.load();
r();
</script>
</body>
</html>
