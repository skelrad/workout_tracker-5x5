<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Workout Tracker — 5x5 (updated)</title>
  <style>
    :root {
      --bg: #f6f7fb;
      --card: #fff;
      --muted: #666;
      --accent: #1f6feb;
      --danger: #c0392b;
    }
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0; padding:24px; background:var(--bg); color:#111;}
    .container { max-width:1100px; margin:0 auto; }
    header { display:flex; align-items:center; gap:16px; margin-bottom:18px;}
    h1 { margin:0; font-size:20px; }
    .card { background:var(--card); border-radius:10px; padding:12px; box-shadow: 0 6px 18px rgba(12,20,40,0.06); margin-bottom:12px;}
    .exercises { display:flex; flex-direction:column; gap:12px; }
    .exercise-row { display:flex; gap:12px; align-items:flex-start; padding:10px; border-radius:8px; border:1px solid rgba(0,0,0,0.04); }
    .exercise-info { flex:1; min-width:220px; }
    .exercise-controls { display:flex; gap:12px; align-items:center; }
    .sets { display:flex; gap:8px; flex-wrap:wrap; }
    .set { width:110px; background:#fbfcff; border-radius:6px; padding:8px; border:1px solid rgba(0,0,0,0.03); display:flex; flex-direction:column; gap:6px; align-items:center; }
    .weight-input { width:100%; text-align:center; font-weight:600; border-radius:6px; padding:6px; border:1px solid rgba(0,0,0,0.06); background:white; }
    .inc-row { display:flex; gap:6px; flex-wrap:wrap; justify-content:center; }
    button { border:0; background:var(--accent); color:white; padding:6px 8px; border-radius:6px; cursor:pointer; font-weight:600; }
    button.secondary { background:#e6e9f2; color:#111; }
    button.mini { padding:4px 6px; font-size:13px; }
    .btn-danger { background:var(--danger); }
    label { font-size:13px; color:var(--muted); display:block; margin-bottom:6px; }
    .small { font-size:12px; color:var(--muted); }
    .controls { display:flex; gap:8px; align-items:center; }
    .top-actions { display:flex; gap:8px; align-items:center; margin-bottom:12px; }
    input[type="text"], input[type="number"] { padding:8px; border-radius:6px; border:1px solid rgba(0,0,0,0.06); }
    .muted { color:var(--muted); font-size:13px; }
    @media (max-width:880px){
      .sets { gap:6px; }
      .set { width:48%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Workout Tracker — 5x5 (updated)</h1>
      <div class="muted">Weight increments: −10, −5, −3, 0, +3, +5, +10 | Weight exercises show 5 sets</div>
    </header>

    <section class="card top-actions">
      <div style="display:flex; gap:12px; align-items:center;">
        <label for="new-exercise-name">Add exercise</label>
        <input id="new-exercise-name" placeholder="e.g., Squat" type="text" />
        <select id="new-exercise-type">
          <option value="weight">Weight</option>
          <option value="bodyweight">Bodyweight</option>
          <option value="cardio">Cardio</option>
          <option value="other">Other</option>
        </select>
        <button id="add-exercise">Add</button>
      </div>
      <div style="margin-left:auto">
        <button id="export" class="secondary mini">Export JSON</button>
        <button id="import" class="secondary mini">Import JSON</button>
        <button id="clear" class="btn-danger mini">Clear All</button>
      </div>
    </section>

    <main class="exercises" id="exercises"></main>

    <section class="card" style="margin-top:18px;">
      <div class="small">Notes: This version replaces the older small increments (1.5, 3.5, etc.) with the seven increments specified and ensures all weight exercises show 5 sets. We store exact numeric weights in localStorage.</div>
    </section>
  </div>

<script>
/*
  Workout Tracker — single-file replacement (Option 2 behavior)
  - Weight exercises (type === 'weight') will have 5 sets
  - Increment buttons for weight-based sets are: -10, -5, -3, 0, +3, +5, +10
  - All weights are stored exactly in localStorage as numbers
  - This file includes small sample data; you can remove/replace as needed.
*/

const INC_VALUES = [-10, -5, -3, 0, +3, +5, +10]; // required set of increments
const SETS_PER_WEIGHT_EXERCISE = 5;
const STORAGE_KEY = 'wt_5x5_v1';

function newId() {
  return 'e' + Math.random().toString(36).slice(2,9);
}

/* sample data */
const defaultState = {
  exercises: [
    { id: newId(), name: 'Squat', type: 'weight', baseWeight: 135, sets: [135, 135, 135, 135, 135] },
    { id: newId(), name: 'Bench Press', type: 'weight', baseWeight: 95, sets: [95, 95, 95, 95, 95] },
    { id: newId(), name: 'Barbell Row', type: 'weight', baseWeight: 65, sets: [65, 65, 65, 65, 65] },
    { id: newId(), name: 'Push-ups', type: 'bodyweight', notes: '3 sets to failure' },
    { id: newId(), name: 'Bike', type: 'cardio', notes: '20 min steady' }
  ]
};

function loadState() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return JSON.parse(JSON.stringify(defaultState));
    return JSON.parse(raw);
  } catch(e) {
    console.error('Failed to load state', e);
    return JSON.parse(JSON.stringify(defaultState));
  }
}

function saveState(state) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

/* Utilities for exact storage and arithmetic:
   We don't force rounding; we allow floats. Buttons change by integer amounts,
   but direct edits accept decimals (user-friendly).
*/
function toNumber(v) {
  if (v === '' || v === null || v === undefined) return 0;
  const n = Number(v);
  return Number.isFinite(n) ? n : 0;
}

/* DOM helpers */
const dom = {
  exercisesEl: document.getElementById('exercises'),
  addBtn: document.getElementById('add-exercise'),
  newName: document.getElementById('new-exercise-name'),
  newType: document.getElementById('new-exercise-type'),
  exportBtn: document.getElementById('export'),
  importBtn: document.getElementById('import'),
  clearBtn: document.getElementById('clear')
};

let state = loadState();

/* RENDERING */
function render() {
  dom.exercisesEl.innerHTML = '';
  state.exercises.forEach(ex => {
    const row = document.createElement('div');
    row.className = 'exercise-row card';
    // Left: info
    const info = document.createElement('div');
    info.className = 'exercise-info';
    const title = document.createElement('div');
    title.style.display = 'flex';
    title.style.justifyContent = 'space-between';
    title.style.alignItems = 'center';

    const name = document.createElement('div');
    name.innerHTML = `<strong>${escapeHtml(ex.name)}</strong> <span class="muted">(${escapeHtml(ex.type)})</span>`;
    title.appendChild(name);

    const actions = document.createElement('div');
    actions.className = 'controls';
    const editBtn = document.createElement('button');
    editBtn.className = 'secondary mini';
    editBtn.textContent = 'Rename';
    editBtn.onclick = () => {
      const n = prompt('Rename exercise', ex.name);
      if (n !== null) {
        ex.name = n.trim() || ex.name;
        saveState(state);
        render();
      }
    };
    const removeBtn = document.createElement('button');
    removeBtn.className = 'btn-danger mini';
    removeBtn.textContent = 'Delete';
    removeBtn.onclick = () => {
      if (!confirm('Delete exercise?')) return;
      state.exercises = state.exercises.filter(e => e.id !== ex.id);
      saveState(state);
      render();
    };
    actions.appendChild(editBtn);
    actions.appendChild(removeBtn);
    title.appendChild(actions);

    info.appendChild(title);

    // optional notes/base weight
    if (ex.type === 'weight') {
      const lbl = document.createElement('label');
      lbl.innerText = 'Base weight (editable, used for quick set population)';
      const baseIn = document.createElement('input');
      baseIn.type = 'number';
      baseIn.step = '0.5';
      baseIn.className = 'weight-input';
      baseIn.value = toNumber(ex.baseWeight);
      baseIn.onchange = () => {
        ex.baseWeight = toNumber(baseIn.value);
        // if sets missing or shorter, ensure 5 sets exist when weight-based:
        ex.sets = ensureSetsArray(ex.sets, SETS_PER_WEIGHT_EXERCISE, ex.baseWeight);
        saveState(state);
        render(); // re-render to update set inputs
      };
      lbl.appendChild(baseIn);
      info.appendChild(lbl);
    } else {
      const lbl = document.createElement('label');
      lbl.textContent = 'Notes';
      const notes = document.createElement('input');
      notes.type = 'text';
      notes.value = ex.notes || '';
      notes.onchange = () => {
        ex.notes = notes.value;
        saveState(state);
      };
      lbl.appendChild(notes);
      info.appendChild(lbl);
    }

    // Right: controls (sets / increments)
    const ctr = document.createElement('div');
    ctr.className = 'exercise-controls';

    if (ex.type === 'weight') {
      // Ensure ex.sets exists and has exactly 5 sets
      ex.sets = ensureSetsArray(ex.sets, SETS_PER_WEIGHT_EXERCISE, ex.baseWeight || 0);

      const setsWrap = document.createElement('div');
      setsWrap.className = 'sets';
      ex.sets.forEach((w, idx) => {
        const setEl = document.createElement('div');
        setEl.className = 'set';
        setEl.innerHTML = `<div class="small">Set ${idx+1}</div>`;
        const input = document.createElement('input');
        input.type = 'number';
        input.step = '0.5';
        input.className = 'weight-input';
        input.value = w;
        input.onchange = () => {
          ex.sets[idx] = toNumber(input.value);
          saveState(state);
        };
        setEl.appendChild(input);

        // increment row
        const incRow = document.createElement('div');
        incRow.className = 'inc-row';
        INC_VALUES.forEach(v => {
          const b = document.createElement('button');
          b.className = 'secondary mini';
          b.textContent = (v > 0 ? '+'+v : v.toString());
          b.onclick = () => {
            // update exact number without rounding
            const current = toNumber(ex.sets[idx]);
            const updated = current + v;
            ex.sets[idx] = updated;
            saveState(state);
            render(); // re-render so displayed value syncs
          };
          incRow.appendChild(b);
        });

        // a quick copy-from-base button
        const copyBtn = document.createElement('button');
        copyBtn.className = 'mini';
        copyBtn.textContent = 'Use base';
        copyBtn.onclick = () => {
          ex.sets[idx] = toNumber(ex.baseWeight);
          saveState(state);
          render();
        };

        setEl.appendChild(incRow);
        setEl.appendChild(copyBtn);

        setsWrap.appendChild(setEl);
      });

      ctr.appendChild(setsWrap);

    } else {
      // Non weight-based: show a simple reps/sets field (user editable)
      const lbl = document.createElement('label');
      lbl.textContent = 'Details';
      const details = document.createElement('input');
      details.type = 'text';
      details.value = ex.notes || '';
      details.onchange = () => {
        ex.notes = details.value;
        saveState(state);
      };
      lbl.appendChild(details);
      ctr.appendChild(lbl);
    }

    row.appendChild(info);
    row.appendChild(ctr);
    dom.exercisesEl.appendChild(row);
  });
}

/* Ensure a sets array exists and is EXACTLY desired length.
   If missing, fill from baseWeight or zero.
*/
function ensureSetsArray(arr, length, baseWeight) {
  const result = Array.isArray(arr) ? arr.slice(0, length) : [];
  while (result.length < length) {
    result.push(baseWeight !== undefined ? toNumber(baseWeight) : 0);
  }
  return result;
}

/* Add / Remove handlers */
dom.addBtn.addEventListener('click', () => {
  const name = dom.newName.value.trim();
  if (!name) {
    alert('Please enter an exercise name');
    return;
  }
  const type = dom.newType.value;
  const ex = { id: newId(), name, type };
  if (type === 'weight') {
    ex.baseWeight = 45;
    ex.sets = ensureSetsArray([], SETS_PER_WEIGHT_EXERCISE, ex.baseWeight);
  } else {
    ex.notes = '';
  }
  state.exercises.push(ex);
  saveState(state);
  dom.newName.value = '';
  render();
});

/* Export / Import / Clear */
dom.exportBtn.addEventListener('click', () => {
  const data = JSON.stringify(state, null, 2);
  prompt('Copy this JSON to backup or transfer to another device', data);
});
dom.importBtn.addEventListener('click', () => {
  const txt = prompt('Paste JSON export here');
  if (!txt) return;
  try {
    const obj = JSON.parse(txt);
    if (!obj || !Array.isArray(obj.exercises)) throw new Error('Invalid');
    state = obj;
    saveState(state);
    render();
  } catch (e) {
    alert('Import failed: ' + e.message);
  }
});
dom.clearBtn.addEventListener('click', () => {
  if (!confirm('Clear all data (this cannot be undone)?')) return;
  state = { exercises: [] };
  saveState(state);
  render();
});

/* escape helper to keep display safe */
function escapeHtml(s) {
  return String(s || '').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}

/* Initialize */
render();

</script>
</body>
</html>
