<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Progressive 5x5 Dumbbell Program</title>
<style>
:root{--accent:#3b82f6;--success:#10b981;--danger:#ef4444;--muted:#6b7280}
*{box-sizing:border-box}
body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;background:#f5f5f5;margin:0;padding:20px;color:#111}
.container{max-width:1100px;margin:0 auto}
.card{background:#fff;padding:18px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.06);margin-bottom:18px}
h1{font-size:1.4rem;margin:0 0 6px}
p.lead{margin:0;color:var(--muted)}
.controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
.week-selector{display:flex;gap:8px;flex-wrap:wrap}
.week-btn{padding:8px 12px;border-radius:8px;border:2px solid #ddd;background:#fff;font-weight:600;cursor:pointer}
.week-btn:hover{background:#f3f4f6}
.week-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}
.week-btn.deload{background:#fef3c7;border-color:#fbbf24}
.week-btn.deload.active{background:#fbbf24;color:#78350f}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
.day-card{padding:14px;border-radius:8px;border:2px solid transparent;cursor:pointer}
.day-card:hover{transform:translateY(-4px);transition:transform .12s}
.day-card.selected{border-color:var(--accent);background:#eff6ff}
.exercise-card{padding:12px;border-radius:8px;border:1px solid #e6e6e6;margin-bottom:10px;background:#fafafa}
.set-buttons{display:flex;gap:8px;flex-wrap:wrap}
.set-btn{padding:8px 10px;border-radius:6px;border:1px solid #d1d5db;background:#fff;cursor:pointer;position:relative}
.set-btn.complete{background:var(--success);color:#fff;border-color:var(--success)}
.set-btn.failed{background:var(--danger);color:#fff;border-color:var(--danger)}
.hidden{display:none}
.muted{color:var(--muted);font-size:.95rem}
.flex{display:flex;gap:12px;align-items:center}
.spacer{flex:1}
.small{font-size:.9rem}
.alert{padding:12px;border-radius:8px;background:#dbeafe;border-left:4px solid var(--accent);margin-bottom:14px}
footer{margin-top:18px;text-align:center;color:var(--muted);font-size:0.9rem}
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <h1>Progressive 5x5 Dumbbell Program</h1>
    <p class="lead">Track sets, weights, and manual progression. Every 4th week is a deload.</p>
    <div id="cycleInfo" class="muted small" style="margin-top:10px"></div>
  </div>

  <div class="card controls" aria-label="controls">
    <div>
      <strong>Select Week</strong>
      <div id="weekSelector" class="week-selector" aria-label="week selector"></div>
    </div>
    <div class="spacer"></div>
    <div style="min-width:220px;text-align:right">
      <button id="exportBtn" class="week-btn" title="Export CSV">Download CSV</button>
      <button id="resetBtn" class="week-btn" title="Reset progress">Reset</button>
    </div>
  </div>

  <div id="weekAlert" class="alert hidden" role="status"></div>
  <div id="workoutGrid" class="grid"></div>
  <div id="workoutDetail" class="card hidden" aria-live="polite"></div>
  <footer class="muted">Built for local usage — data stored in your browser (localStorage).</footer>
</div>

<script>
(function(){
'use strict';

// ---------------- DATA ----------------
const PROGRAM = {
  1: { name: "Upper Body Push", exercises:[
    {name:"Incline Dumbbell Press", sets:5, startWeight:25, notes:"Focus on upper chest"},
    {name:"Standing Overhead Press", sets:5, startWeight:20, notes:"Strict form"},
    {name:"Dumbbell Floor Press", sets:5, startWeight:30, notes:"Protect shoulders"}
  ]},
  2: { name: "Lower Body", exercises:[
    {name:"Goblet Squats", sets:5, startWeight:40, notes:"Hold one DB at chest"},
    {name:"Romanian Deadlifts", sets:5, startWeight:30, notes:"Hinge at hips"}
  ]}
};

// ---------------- STORAGE ----------------
const DataStore = {
  prefix:'prog_v2_',
  key(...parts){ return this.prefix + parts.join('|'); },
  getCycle(){ return parseInt(localStorage.getItem(this.key('currentCycle'))||'1',10); },
  setCycle(v){ localStorage.setItem(this.key('currentCycle'),v); },
  getWeek(){ return parseInt(localStorage.getItem(this.key('currentWeek'))||'1',10); },
  setWeek(v){ localStorage.setItem(this.key('currentWeek'),v); },
  getProgress(day,ex,set){ return localStorage.getItem(this.key('p',day,ex,'s'+set))||null; },
  saveProgress(day,ex,set,val){ localStorage.setItem(this.key('p',day,ex,'s'+set),val); },
  removeProgress(day,ex,set){ localStorage.removeItem(this.key('p',day,ex,'s'+set)); },
  getWeight(day,ex){ const v=localStorage.getItem(this.key('w',day,ex)); return v!==null?parseFloat(v):PROGRAM[day].exercises[ex-1].startWeight; },
  saveWeight(day,ex,val){ localStorage.setItem(this.key('w',day,ex),val); },
  getAdjustment(day,ex){ const v=localStorage.getItem(this.key('a',day,ex)); return v!==null?parseInt(v,10):null; },
  saveAdjustment(day,ex,val){ localStorage.setItem(this.key('a',day,ex),val); },
  removeAdjustment(day,ex){ localStorage.removeItem(this.key('a',day,ex)); },
  exportCSV(){
    const rows=[['key','value']];
    for(let i=0;i<localStorage.length;i++){
      const k=localStorage.key(i);
      if(k&&k.startsWith(this.prefix)) rows.push([k,localStorage.getItem(k)]);
    }
    return rows.map(r=>r.map(c=>`"${c}"`).join(',')).join('\n');
  },
  resetAll(){ Object.keys(localStorage).forEach(k=>{ if(k.startsWith(this.prefix)) localStorage.removeItem(k); }); }
};

// ---------------- UI ----------------
const UI = {
  cycleInfo: document.getElementById('cycleInfo'),
  weekSelector: document.getElementById('weekSelector'),
  grid: document.getElementById('workoutGrid'),
  detail: document.getElementById('workoutDetail'),
  exportBtn: document.getElementById('exportBtn'),
  resetBtn: document.getElementById('resetBtn'),

  renderCycleInfo(week){ this.cycleInfo.textContent = `Week ${week}`; },

  clear(el){ while(el.firstChild) el.removeChild(el.firstChild); },

  renderWeekSelector(currentWeek){
    this.clear(this.weekSelector);
    for(let w=1;w<=12;w++){
      const btn=document.createElement('button');
      btn.type='button'; btn.className='week-btn'; btn.textContent='Week '+w;
      if(w===currentWeek) btn.classList.add('active');
      btn.dataset.week=w;
      btn.addEventListener('click',()=>{ DataStore.setWeek(w); render(); });
      this.weekSelector.appendChild(btn);
    }
  },

  renderDaysGrid(){
    this.clear(this.grid);
    Object.keys(PROGRAM).forEach(d=>{
      const day=parseInt(d,10);
      const card=document.createElement('div');
      card.className='card day-card'; card.tabIndex=0; card.dataset.day=day;
      card.innerHTML=`<strong>Day ${day}</strong><br><span class="muted small">${PROGRAM[day].name}</span>`;
      card.addEventListener('click',()=>selectDay(day));
      card.addEventListener('keydown',e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); selectDay(day); } });
      this.grid.appendChild(card);
    });
  },

  renderWorkoutDetail(day){
    if(!day){ this.detail.classList.add('hidden'); return; }
    this.detail.classList.remove('hidden'); this.clear(this.detail);
    const exercises=PROGRAM[day].exercises;
    exercises.forEach((ex,idx)=>{
      const exIdx=idx+1;
      const card=document.createElement('div'); card.className='exercise-card';
      const weight=DataStore.getWeight(day,exIdx);
      card.innerHTML=`<strong>${ex.name}</strong> — ${weight} lbs<br>${ex.notes||''}`;
      const setRow=document.createElement('div'); setRow.className='set-buttons'; setRow.style.marginTop='8px';
      for(let s=1;s<=ex.sets;s++){
        const b=document.createElement('button'); b.type='button'; b.className='set-btn'; b.textContent='Set '+s;
        function updateStyle(state){
          b.classList.remove('complete','failed');
          if(state==='complete') b.classList.add('complete');
          else if(state==='failed') b.classList.add('failed');
        }
        updateStyle(DataStore.getProgress(day,exIdx,s));
        b.addEventListener('click',ev=>{
          const rect=b.getBoundingClientRect();
          const clickX=ev.clientX-rect.left;
          const state=DataStore.getProgress(day,exIdx,s);
          let next=null;
          if(ev.detail===2){ next=null; } // double click clears
          else if(clickX<rect.width/2){ next='complete'; } else{ next='failed'; }
          if(next===null) DataStore.removeProgress(day,exIdx,s);
          else DataStore.saveProgress(day,exIdx,s,next);
          updateStyle(next);
        });
        setRow.appendChild(b);
      }
      card.appendChild(setRow);

      // manual weight buttons
      const adjRow=document.createElement('div'); adjRow.className='set-buttons'; adjRow.style.marginTop='8px';
      const manual=[-5,-3,-1,0,3,5,10,'Clear'];
      manual.forEach(v=>{
        const btn=document.createElement('button'); btn.type='button'; btn.className='week-btn'; btn.style.padding='6px 8px';
        btn.textContent=v==='Clear'?v:(v>0?`+${v}`:`${v}`);
        const savedAdj=DataStore.getAdjustment(day,exIdx);
        if((v==='Clear'&&savedAdj===null)||savedAdj===v) btn.style.background='#3b82f6',btn.style.color='#fff';
        btn.addEventListener('click',()=>{
          if(v==='Clear') DataStore.removeAdjustment(day,exIdx);
          else DataStore.saveAdjustment(day,exIdx,v);
          render();
        });
        adjRow.appendChild(btn);
      });
      card.appendChild(adjRow);
      UI.detail.appendChild(card);
    });
  }
};

// ---------------- CONTROLLER ----------------
let selectedDay=null;
function selectDay(day){ selectedDay=day; UI.renderWorkoutDetail(day); render(); }

UI.exportBtn.addEventListener('click',()=>{
  const blob=new Blob([DataStore.exportCSV()],{type:'text/csv'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='workout.csv'; a.click(); URL.revokeObjectURL(a.href);
});
UI.resetBtn.addEventListener('click',()=>{ if(confirm('Reset all progress?')){ DataStore.resetAll(); render(); } });

function render(){
  const week=DataStore.getWeek();
  UI.renderCycleInfo(week);
  UI.renderWeekSelector(week);
  UI.renderDaysGrid();
  UI.renderWorkoutDetail(selectedDay);
}

render();

})();
</script>
</body>
</html>
